<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script>
	google.load("gdata", "1.x");
	google.setOnLoadCallback(initFunc);
	var contactsService;

	function setupContactsService() {
		contactsService = new google.gdata.contacts.ContactsService(
				'exampleCo-exampleApp-1.0');
	}

	function logMeIn() {
		var scope = 'https://www.google.com/m8/feeds';
		var token = google.accounts.user.login(scope);
	}
	function logMeOut() {
		google.accounts.user.logout();
	}
	function initFunc() {
		setupContactsService();
		logMeIn();
		getMyContacts();
	}
	function getMyContacts() {
		var contactsFeedUri = 'https://www.google.com/m8/feeds/contacts/default/full';
		var query = new google.gdata.contacts.ContactQuery(contactsFeedUri);

		// Set the maximum of the result set to be 5
		query.setMaxResults(5);

		contactsService.getContactFeed(query, handleContactsFeed, handleError);
	}

	var handleContactsFeed = function(result) {
		var entries = result.feed.entry;

		for ( var i = 0; i < entries.length; i++) {
			var contactEntry = entries[i];
			var emailAddresses = contactEntry.getEmailAddresses();

			for ( var j = 0; j < emailAddresses.length; j++) {
				var emailAddress = emailAddresses[j].getAddress();
				alert('email = ' + emailAddress);
			}
		}
	}
	function handleError(e) {
		alert("There was an error!");
		alert(e.cause ? e.cause.statusText : e.message);
	}
</script>
<script>
	// Called when a message is passed.  We assume that the content script
	// wants to show the page action.
	function onRequest(request, sender, sendResponse) {
		// Show the page action for the tab that the sender (content script)
		// was on.
		chrome.pageAction.show(sender.tab.id);

		// Return nothing to let the connection be cleaned up.
		sendResponse({});
	};

	// Listen for the content script to send a message to the background page.
	chrome.extension.onRequest.addListener(onRequest);
</script>
</head>
</html>
